{% if step is not defined %}
    {% set step = 1 %}
{% endif %}
<div class="panel-heading" style="background-color: #b8b8b8;border-color: #b8b8b8;color:#ffffff">
    <div class="container-fluid no_padding">
        <h2 class="panel-title" style="font-size: 23px;">Create a Dealership</h2>
    </div>
</div>
<div class="mobile" style="background-color: #ffffff">
<div class="panel-body" style="padding: 0px;">
<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true"
     style="margin-left: 1px;margin-right: 1px">
{# Start of tab 1 #}
<div class="panel panel-default" style="border: none">
    <div class="panel-heading" role="tab" id="headingOne">
        <li class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
            href="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                         <span class="pull-right"><span
                                     class="glyphicon glyphicon-info-sign glyphicon-align-right nochange"
                                     aria-hidden="true" style="margin-left: 10px;"></span></span>Dealer
            Information
        </li>
    </div>
    <div id="collapseOne"
         class="col-md-12 panel-collapse collapse {% if step == 1 %} in {% endif %} "
         role="tabpanel" aria-labelledby="headingOne" style="padding: 15px">
        <p> Let's get started! Name your property and tells us some of the basics, including size,
            number
            of
            bedrooms, and how you would like to be contacted. You can edit or update page as often
            as
            required. Make
            sure to click "Save" when you're finished!
        </p>

        <form id="form-description"
              action="{{ path('set_description' , {'type': 'save', 'prop_pk' : prop_pk }) }}" {{ form_enctype(form1) }}
              method="POST" class="form-horizontal formulario" style="margin-top: 20px">
            <input type="hidden" name="_csrf_token" value="{{ csrf_token('registration') }}">

            <div class="form-group" style="margin-bottom: 10px">
                <div class="col-sm-12 col-xs-12 text-left">
                    <span style="color: red">*</span>{{ form_label(form1.description.name) }}
                </div>
                <div class="col-sm-12 col-xs-12">
                    {{ form_widget(form1.description.name) }}
                </div>
                <div class="col-sm-12 col-xs-12 text-danger">
                    {{ form_errors(form1.description.name) }}
                </div>
            </div>

            <div class="form-group" style="margin-bottom: 10px">
                <div class="col-sm-12 col-xs-12 text-left">
                    <span style="color: red">*</span>{{ form_label(form1.description.phone) }}
                </div>
                <div class="col-sm-12 col-xs-12">
                    {{ form_widget(form1.description.phone) }}
                </div>
                <div class="col-sm-12 col-xs-12 text-danger">
                    {{ form_errors(form1.description.phone) }}
                </div>
            </div>

            <div class="form-group" style="margin-bottom: 10px">
                <div class="col-sm-12 col-xs-12 text-left">
                    <span style="color: red">*</span>{{ form_label(form1.description.address) }}
                </div>
                <div class="col-sm-12 col-xs-12">
                    {{ form_widget(form1.description.address) }}
                </div>
                <div class="col-sm-12 col-xs-12 text-danger">
                    {{ form_errors(form1.description.address) }}
                </div>
            </div>

            <div class="form-group" style="margin-bottom: 10px">
                <div class="col-sm-12 col-xs-12 text-letf">
                    <span style="color: red">*</span>{{ form_label(form1.description.email) }}
                </div>
                <div class="col-sm-12 col-xs-12">
                    {{ form_widget(form1.description.email) }}
                </div>
                <div class="col-sm-12 col-xs-12 text-danger">
                    {{ form_errors(form1.description.email) }}
                </div>
            </div>

            <div class="form-group" style="margin-bottom: 10px">

                <div class="col-sm-12 col-xs-12 text-left">
                    {{ form_label(form1.description.hoursopen) }}
                </div>
                <div class="col-sm-6 col-xs-6" style="padding-right: 5px">
                    {{ form_widget(form1.description.hoursopen) }}
                </div>

                <div class="col-sm-6 col-xs-6" style="padding-left: 5px">
                    {{ form_widget(form1.description.hoursclose) }}
                </div>

            </div>
            <div class="col-sm-12 col-xs-12 text-danger">
                {{ form_errors(form1.description.hoursopen) }}
                {{ form_errors(form1.description.hoursclose) }}
            </div>

            <div class="form-group" style="margin-bottom: 10px">
                <div class="col-sm-12 col-xs-12 text-left">
                    {{ form_label(form1.description.webPage) }}
                </div>
                <div class="col-sm-12 col-xs-12">
                    {{ form_widget(form1.description.webPage) }}
                </div>
                <div class="col-sm-12 col-xs-12 text-danger">
                    {{ form_errors(form1.description.webPage) }}
                </div>
            </div>

            <div class="form-group" style="margin-bottom: 10px">
                <div class="col-xs-5 text-left no_padding" style="padding-left: 0px !important; ">
                    <div class="col-sm-6 col-xs-12 text-left">
                        {{ form_label(form1.photo) }}
                    </div>
                    <div class="col-sm-6 col-xs-12 text-left hide">
                        <input type="file" accept="image/*" name="profile_photoM" id="profile_photoM">
                        {{ form_widget(form1.photo) }}
                    </div>
                </div>
                <div class="col-xs-5 text-center no_padding" style="padding-right: 55px !important;">
                    <div id="logobrowseM" class="well" style="width: 144px;height: auto;">
                        {% if logo is not defined or logo == "" %}
                            <p id="logotextM" class="text-uppercase bold_text_white">
                                Click Here<br>
                                To Browse<br>
                                For Logo
                            </p>
                        {% endif %}
                        <div id="logoimageM"
                             class="col-md-5 logo img-responsive {% if logo is null %} hide {% endif %}"
                             style="width:144px;height: 100px;  {% if logo is defined %} background-image: url({{ asset(logo) }}) {% endif %}">

                        </div>

                    </div>
                </div>
                <div class="col-sm-12 col-xs-12 text-danger">
                    {{ form_errors(form1.photo) }}
                </div>
            </div>
            <div class="form-group" style="margin-bottom: 10px">
                <div class="col-xs-12">
                    <button id="btnsave1" type="submit" class="btn btn-primary">Save</button>
                    <button id="btnsavecontinue1" type="submit" class="btn btn-primary"
                            style="margin-left: 10px">
                        Save &
                        Continue
                    </button>
                </div>
            </div>
            {{ form_rest(form1) }}
        </form>
    </div>
</div>
{# End of tab 1 #}
{# Start of tab 2 #}
{% if profile.getServices()|length > 0 or (app.session.get('saved') > 1 or step == 2) %}
    <div class="panel panel-default" style="border: none">
        <div class="panel-heading" role="tab" id="headingTwo">
            <li class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                         <span class="pull-right"><span class="fal_icon servicetoolsicon"
                                                        aria-hidden="true" style="margin-left: 10px;"></span></span>Services
                and Amenities
            </li>
        </div>
        <div id="collapseTwo"
             class="col-md-12 panel-collapse collapse {% if step == 2 %} in {% endif %}"
             role="tabpanel" aria-labelledby="headingTwo">

            <p>This is the basic information needed to create your ad. It will appear on your listing
                and detailed ad.This is the basic information needed to create your ad. It will appear
                on your listing
                and detailed ad.</p>

            <form id="form-servicesM"
                  action="{{ path('set_amenities' , {'type':'save' , 'prop_pk':prop_pk}) }}" {{ form_enctype(formservice) }}
                  method="POST" class="form-horizontal formulario" style="margin-top: 20px">
                <input type="hidden" name="_csrf_token" value="{{ csrf_token('registration') }}">

                <div class="form-group">
                    <div class="form-inline">
                        {% set desciptioncounter = 0 %}
                        {% for serv in formservice.services|slice( 0, 4 ) %}
                            <div class="col-xs-12 col-sm-12 no_padding">
                                <div class="col-xs-12 col-sm-12">
                                    {{ form_widget(serv) }} {{ form_label(serv) }}
                                </div>
                                <div class="col-xs-12 col-sm-12">
                                    <textarea
                                            class="form-control description " {% if serv.vars.data != 1 %} disabled {% endif %}
                                            placeholder="Description" rows="2"
                                            style="margin-bottom: 10px;width: 100% !important;">{{ servicesdescriptions[desciptioncounter] }}</textarea>

                                </div>
                                {% set desciptioncounter = desciptioncounter + 1 %}
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-xs-12 text-left form-title">
                        Useful Information
                    </div>

                    <div class="col-sm-12 col-xs-12 text-left">
                        <p>This is the basic information needed to create your ad. It will appear on your listing
                            and detailed ad.This is the basic information needed to create your ad. It will appear
                            on your listing
                            and detailed ad.</p>
                    </div>
                </div>

                <div class="form-group form-inline" style="margin-top: 20px;margin-bottom: 10px">
                    <div class="col-sm-3 col-xs-12">
                        {{ form_label(formservice.usefulinformation.languages) }}
                    </div>
                    <div id="languages" class="col-sm-9 col-xs-12" style="padding-top: 0px">
                        {% for language in formservice.usefulinformation.languages %}

                            <div class="col-sm-3 col-xs-3">
                                <div class="checkbox col-sm-12">
                                    {{ form_widget(language) }} {{ form_label(language) }}
                                </div>
                            </div>

                        {% endfor %}
                    </div>
                </div>

                <div class="form-group" style="margin-bottom: 10px">
                    <div class="col-sm-3 col-xs-12">
                        {{ form_label(formservice.usefulinformation.whyBuyaCar) }}

                    </div>
                    <div class="col-sm-5 col-xs-12">
                        {{ form_widget(formservice.usefulinformation.whyBuyaCar) }}

                    </div>

                    <div class="col-sm-3 col-xs-12 text-danger">
                        {{ form_errors(formservice.usefulinformation.whyBuyaCar) }}

                    </div>
                </div>

                <div class="form-group" style="margin-bottom: 10px">
                    <div class="col-sm-3 col-xs-12">
                        {{ form_label(formservice.usefulinformation.Disclaimer) }}

                    </div>
                    <div class="col-sm-5 col-xs-12">
                        {{ form_widget(formservice.usefulinformation.Disclaimer) }}

                    </div>

                    <div class="col-sm-3 col-xs-12 text-danger">
                        {{ form_errors(formservice.usefulinformation.Disclaimer) }}

                    </div>
                </div>

                <div class="form-group" style="margin-bottom: 10px">
                    <div class="col-xs-12">
                        <button id="btnsave2" type="submit" class="btn btn-primary">Save</button>
                        <button id="btnsavecontinue2" type="submit" class="btn btn-primary"
                                style="margin-left: 10px">
                            Save &
                            Continue
                        </button>
                    </div>
                </div>
                <div class="hide">
                    {{ form_rest(formservice) }}
                </div>
            </form>

        </div>
    </div>
{% endif %}
{# End of tab 2 #}
{# Start of tab 3 #}
{% if profile.gallery or (app.session.get('saved') > 2 or step == 3) %}
    <div class="panel panel-default" style="border: none">
    <div class="panel-heading" role="tab" id="headingThree">
        <li class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
            href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                         <span class="pull-right"><span class="fal_icon photosicon"
                                                        aria-hidden="true" style="margin-left: 10px;"></span></span>Photos
        </li>
    </div>
    <div id="collapseThree"
         class="col-xs-12 panel-collapse collapse {% if step == 3 %} in {% endif %}"
         role="tabpanel" aria-labelledby="headingThree">

    <p>Upload your property pictures and add a title or a brief description.
        The
        first image in the gallery will be your Featured Picture. You can change the order of the photos
        by
        dragging them to their new location. Make sure to click "Save" when you're finished!</p>

    <div class="form-group" style="margin-bottom: 10px">

                                <span class="btn btn-default b2b active pull-left" data-toggle="modal"
                                      data-target="#myModalGallery"
                                      style="margin-bottom: 10px; margin-top: 10px;">
                                <i class="glyphicon glyphicon-plus"></i>
                                <span>Add Photos...</span>
                              </span>

    </div>

    <form id="form-gallery"
          action="{{ path('set_gallery' , {'type':'save' , 'prop_pk':prop_pk}) }}" {{ form_enctype(formgallery) }}
          method="POST" class="form-horizontal" style="margin-top: 20px">
        <input type="hidden" name="_csrf_token" value="{{ csrf_token('registration') }}">

        <div class="col-sm-12 col-xs-12 text-left text-danger gallery-error">
            {% if formgallery.vars is defined %}
                {% if not formgallery.vars.valid %}
                    {% for prop in formgallery.profileImages %}
                        {{ form_errors(prop.photo) }}
                    {% endfor %}
                {% endif %}
            {% endif %}
        </div>


        <div>

            <div class="form-group" style="margin-bottom: 10px">
                <div class="col-xs-12 text-left form-title">
                    <div style="margin-right: 20px"><a
                                class="pull-left btn btn-default uploadMultipleVisible hide" href="#">Upload
                            Multiple Images</a></div>

                </div>

                <div class="col-xs-6 col-sm-6 text-left top-content" style="padding-left: 15px">
                    <div class="tumb-large"></div>

                </div>
                <div class="col-xs-6 col-sm-6 text-left top-content"
                     style="margin-top: 115px;min-height: 21px">
                    <div class="title featured-picture" style="font-size: 16px;color: #2c9ec8;position: absolute;">
                        Featured
                        Picture
                    </div>
                </div>
                <div class="col-xs-6 col-sm-6 text-left top-content">
                    <div class="title"><label>Description / Title</label></div>
                </div>
                <div class="col-xs-6 col-sm-6 title-input top-content">
                    <input type="text" class="form-control">
                </div>
                <div class="col-md-2 col-xs-2 text-left top-content" style="margin-top: 5px">

                    <img id="loading" src="{{ asset('bundles/common/images/loading.gif') }}"
                         style="margin-left: 5px; border: 0 none;" class="hide">
                </div>

                <div class="col-md-12 col-xs-12 text-left" style="margin-top: 20px">

                    <div class="title" style="font-size: 16px;color: #2c9ec8">Drag photos to change order
                    </div>

                </div>
            </div>


            <div class="row gallery" id="gallery">
                {% if formgallery.profileImages| length > 0 %}
                    {% for i in 0..7 %}

                        <div class="row col-xs-3 text-left no_padding" style="padding-right: 2px;margin-bottom: 10px">
                            <div class="image-form">
                                {% if formgallery.profileImages[i] is defined %}
                                    {% if formgallery.profileImages[i].vars.data.getWebPath is not null %}
                                        <div class="tumb old"
                                             style="background-image:url('{{ asset(formgallery.profileImages[i].vars.data.getWebPathThumbnail(profile)) }}');"></div>
                                    {% else %}
                                        <div id="gallery_propertyImages_{{ i }}" class="tumb upload"
                                             style="background-image:url('{{ asset('bundles/common/images/image-bg.jpg') }}');"></div>
                                    {% endif %}
                                    <span id="orden"
                                          class="hide">{{ form_widget(formgallery.profileImages[i].orden) }}</span>

                                    <div class="col-md-1 col-xs-12 hide">
                                        {{ form_widget(formgallery.profileImages[i].photo) }}
                                    </div>

                                    <div class="col-md-1 col-xs-12 title-input-source hide">
                                        {{ form_widget(formgallery.profileImages[i].title) }}

                                    </div>
                                    <div class="col-md-1 col-xs-12" style="padding: 0">
                                        {% set picture  = formgallery.profileImages[i].vars.value %}
                                        <input id="pictureId" type="hidden" value="{{ picture.id }}">

                                    </div>
                                {% else %}
                                    {{ include('AdminBundle:Default:image-form.html.twig',{ 'i': i}) }}
                                {% endif %}
                            </div>
                            <span class="orden"> {% set orden = i+1 %}{{ orden }}</span>
                            {% if formgallery.profileImages[i].vars.data.getWebPath is defined %}
                                {% if formgallery.profileImages[i].vars.data.getWebPath is not null %}
                                    <a href="#" class="deleteImage"><span class="glyphicon glyphicon-trash"
                                                                          aria-hidden="true"
                                                                          style="font-size: 12px; margin-left: 5px; top:1px"></span></a>
                                {% else %}
                                    <a href="#" class="hide deleteImage"><span class="glyphicon glyphicon-trash"
                                                                               aria-hidden="true"
                                                                               style="font-size: 12px; margin-left: 5px; top:1px"></span></a>
                                {% endif %}
                            {% else %}
                                <a href="#" class="hide deleteImagePreview"><span
                                            class="glyphicon glyphicon-trash"
                                            aria-hidden="true"
                                            style="font-size: 12px; margin-left: 5px; top:1px"></span></a>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
            <div id="result" class=""></div>
        </div>

        <div class="form-group" style="margin-bottom: 10px">
            <div class="col-sm-12 col-xs-12 text-left">
                <button id="btnsave3" type="submit" class="btn btn-primary">Save</button>
                <button id="btnsavecontinue3" type="submit" class="btn btn-primary"
                        style="margin-left: 10px">
                    Save & Continue
                </button>
            </div>

        </div>

        <div style="display: none">{{ form_rest(formgallery) }}</div>
    </form>

    <div class="modal fade" id="myModalGallery" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">Upload Images</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12 col-xs-12">
                            <div class="form-group">
                                <div class="col-md-11 col-xs-12 text-left">
                                    <div style="margin-right: 20px" class="text-danger"><em>Maximum image size allowed
                                            is 5
                                            MB</em></div>
                                    <div class="text-danger"><em>Minimum image dimensions requirements (400 x 285)</em>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 col-xs-12 text-left" style="padding-left: 30px">

                                <span id="selectfile" class="btn btn-default active fileinput-button pull-left"
                                      style="margin-bottom: 10px; margin-top: 10px;">
                                    <i class="glyphicon glyphicon-picture" style="margin-right: 7px"></i>
                                <span>Select files...</span>
                                <!-- The file input field used as target for the file upload widget -->

                            </span>
                            <input class="hide" id="fileupload" type="file" accept="image/*" name="files[]" multiple>

                            <div class="pull-left text-muted uploading hide"
                                 style="padding-top: 15px; padding-left: 15px">
                                Uploading Images <img id="loading"
                                                      src="{{ asset('bundles/common/images/loading.gif') }}"
                                                      style="margin-left: 5px; border: 0 none;" class=""></div>


                            <!-- The container for the uploaded files -->


                        </div>
                        <div id="files" class="files col-md-12 col-xs-12 text-left" style="padding-left: 30px"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default close-upload" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    </div>
    </div>
{% endif %}
{# End of tab 3 #}
{# Start of tab 4 #}
{% if profile.feeds or (app.session.get('saved') > 3 or step == 4) %}
<div class="panel panel-default" style="border: none">
    <div class="panel-heading" role="tab" id="headingFour">
        <li class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
            href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                         <span class="pull-right"><span class="fal_icon socialfeedicon"
                                                        aria-hidden="true" style="margin-left: 10px;"></span></span>Social
            Media & Web
        </li>
    </div>
    <div id="collapseFour" class="col-md-12 panel-collapse collapse {% if step == 4 %} in {% endif %}"
         role="tabpanel" aria-labelledby="headingFour">

        <p>This is the basic information needed to create your ad. It will appear on your listing
            and detailed ad.This is the basic information needed to create your ad. It will appear
            on your listing
            and detailed ad.</p>

        <form id="form-feeds"
              action="{{ path('set_feeds' , {'type':'save' , 'prop_pk':prop_pk}) }}" {{ form_enctype(formfeed) }}
              method="POST" class="form-horizontal">
            <input type="hidden" name="_csrf_token" value="{{ csrf_token('registration') }}">

            <div class="form-group" style="margin-bottom: 10px">
                <div class="col-sm-3 col-xs-12" style="padding-right: 0">
                    {{ form_label(formfeed.facebook) }}
                </div>
                <div class="col-sm-9 col-xs-12">
                    {{ form_widget(formfeed.facebook) }}

                </div>

            </div>
            <div class="form-group" style="margin-bottom: 30px">
                <div class="col-sm-3 col-xs-12" style="padding-right: 0">
                    {{ form_label(formfeed.twitter) }}
                </div>
                <div class="col-sm-9 col-xs-12">
                    {{ form_widget(formfeed.twitter) }}
                </div>
            </div>

            <div class="form-group" style="margin-bottom: 10px">
                <div class="col-sm-12 col-xs-12 text-left">
                    <button id="btnsave4" type="submit" class="btn btn-primary">Save</button>
                    <button id="btnfinish" type="submit" class="btn btn-primary"
                            style="margin-left: 10px"> Complete Profile
                    </button>
                </div>
            </div>

            {{ form_rest(formfeed) }}


        </form>
    </div>
    {% endif %}
    {# End of tab 4 #}
</div>
</div>
</div>
</div>
<script type="text/javascript">

    var arch1 = null;
    function cargar1(ev) {
        //alert(ev.target.files[0])
        arch1 = new FileReader();
        arch1.addEventListener('load', leer1, false);
        arch1.readAsDataURL(ev.target.files[0]);
    }

    function leer1(ev) {
        try {
            jQuery("#logoimageM").css("background-image", "url(" + arch1.result + ")");
            jQuery("#logotextM").hide();
            jQuery("#logoimageM").removeClass("hide");
        } catch (e) {
            console.log(e);
        }
    }
    jQuery("#logobrowseM").click(function (e) {
        jQuery("#profile_photoM").trigger("click");
    });

    jQuery("#profile_photoM").change(cargar1);

    jQuery('#btnsavecontinue1').click(function (e) {
        jQuery('#form-description').attr('action', "{{path('set_description', {'type':'continue' , 'prop_pk':prop_pk})}}");
    });

    jQuery('#btnsave1').click(function (e) {
        jQuery('#form-description').attr('action', "{{path('set_description', {'type':'save' , 'prop_pk':prop_pk})}}");
    });

    jQuery('#btnsavecontinue2').click(function (e) {
        jQuery('#form-servicesM').attr('action', "{{path('set_amenities', {'type':'continue' , 'prop_pk':prop_pk})}}");
    });

    jQuery('#btnsave2').click(function (e) {
        jQuery('#form-servicesM').attr('action', "{{path('set_amenities', {'type':'save' , 'prop_pk':prop_pk})}}");
    });

    jQuery('#btnsavecontinue3').click(function (e) {
        jQuery('#form-gallery').attr('action', "{{path('set_gallery', {'type':'continue' , 'prop_pk':prop_pk})}}");
    });

    jQuery('#btnsave3').click(function (e) {
        jQuery('#form-gallery').attr('action', "{{path('set_gallery', {'type':'save' , 'prop_pk':prop_pk})}}");
    });

    jQuery('#btnfinish').click(function (e) {
        jQuery('#form-feeds').attr('action', "{{path('set_feeds', {'type':'end' , 'prop_pk':prop_pk})}}");
    });

    jQuery('#btnsave4').click(function (e) {
        jQuery('#form-feeds').attr('action', "{{path('set_feeds', {'type':'save' , 'prop_pk':prop_pk})}}");
    });


    jQuery(document).ready(function () {

        jQuery("input[type=checkbox]").click(function () {
            if (this.checked) {
                jQuery(this).parent().siblings().children().removeAttr("disabled");
            }
            else {
                jQuery(this).parent().siblings().children().attr("disabled", "true");
                jQuery(this).parent().siblings().children().val("");
            }
        });

        SetNameOntextarea();

    });

    function SetNameOntextarea() {
        jQuery(".description").each(function () {
            var id = jQuery(this).parent().prev().find("input[type=checkbox]").attr("id");
            jQuery(this).attr("name", id);
        });
    }
    ;

</script>

<script type="text/javascript">

jQuery(function () {
    'use strict';
    // Change this to the location of your server-side upload handler:
    var url = "{{ path('upload_multiple', {'prop_pk': prop_pk}) }}",
            uploadButton = jQuery('<button/>')
                    .addClass('btn btn-primary')
                    .prop('disabled', true)
                    .text('Processing...')
                    .on('click', function () {
                        var $this = $(this),
                                data = $this.data();
                        $this
                                .off('click')
                                .text('Abort')
                                .on('click', function () {
                                    $this.remove();
                                    data.abort();
                                });
                        data.submit().always(function () {
                            $this.remove();
                        });
                    });

    var maxFiles = 24;
    var counter = 0;
    jQuery('#fileupload').fileupload({
        url: url,
        dataType: 'json',
        autoUpload: true,
        acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
        // Enable image resizing, except for Android and Opera,
        // which actually support image resizing, but fail to
        // send Blob objects via XHR requests:
        disableImageResize: true,
        previewMaxWidth: 100,
        previewMaxHeight: 100,
        previewCrop: true
    }).on('fileuploadadd', function (e, data) {

        if (counter < maxFiles) {
            counter++;
        } else {
            return false;
        }


        data.context = jQuery('<div/>').appendTo('#files');
        jQuery.each(data.files, function (index, file) {

            var node = jQuery('<p/>')
                    .append(jQuery('<span/>').text(file.name));
            if (!index) {
                node.append(' ');
            }

            node.appendTo(data.context);
        });
    }).on('fileuploadprocessalways', function (e, data) {

        var index = data.index,
                file = data.files[index],
                node = jQuery(data.context.children()[index]);
        /*if (file.preview) {
         node
         .prepend('<br>')
         .prepend(file.preview);
         }*/


        if (file.error) {
            node.append(jQuery('<span class="text-danger"/>').text(file.error));
        }
        if (index + 1 === data.files.length) {
            data.context.find('button')
                    .text('Upload')
                    .prop('disabled', !!data.files.error);
        }
    }).on('fileuploaddone', function (e, data) {
        jQuery.each(data.result.files, function (index, file) {
            /* if (file.url) {
             var link = jQuery('<a>')
             .attr('target', '_blank')
             .prop('href', file.url);
             jQuery(data.context.children()[index])
             .wrap(link);
             } else*/
            if (file.error) {
                var error = jQuery('<span class="text-danger"/>').text(file.error);
                jQuery(data.context.children()[index]).append(' ').append(error);
            } else {
                var success = jQuery('<span class="text-success"/>').text('Uploaded');
                jQuery(data.context.children()[index]).append(' ').append(success);
            }
        });
    }).on('fileuploadfail', function (e, data) {
        jQuery.each(data.files, function (index) {
            var error = jQuery('<span class="text-danger"/>').text('File upload failed.');
            jQuery(data.context.children()[index])
                    .append(' ')
                    .append(error);
        });
    }).prop('disabled', !jQuery.support.fileInput)
            .parent().addClass(jQuery.support.fileInput ? undefined : 'disabled');
});


jQuery(function () {
    jQuery('#fileupload').bind('fileuploadstop', function (e) {
        jQuery('.uploading').addClass('hide');
        jQuery('.fileinput-button').removeAttr('disabled');
        jQuery('#form-gallery #btnsave3').removeClass('disabled');
        jQuery('#form-gallery #btnsavecontinue3').removeClass('disabled');
        jQuery('.deleteImage').each(function () {
            jQuery(this).removeClass('hide');
        });
        jQuery('#link-tab-index-1, #link-tab-index-2, #link-tab-index-4, #link-tab-index-6, #link-tab-index-5, #link-tab-index-3, #link-tab-index-7').removeClass('disabled');
        window.location = "{{ path('set_gallery' , {'type':'open' , 'prop_pk':prop_pk}) }}";
    });

});


jQuery(function () {
    jQuery('#fileupload').bind('fileuploadstart', function (e) {
        //jQuery('#myModalGallery').attr('data-backdrop', 'static');
        //jQuery('#myModalGallery').attr('data-keyboard', "false");
        jQuery('.uploading').removeClass('hide');
        jQuery('.fileinput-button').attr('disabled', 'disabled');
        jQuery('.close-upload').attr('disabled', 'disabled');
        jQuery('.deleteImage').each(function () {
            jQuery(this).addClass('hide');
        });
        jQuery('#link-tab-index-1, #link-tab-index-2, #link-tab-index-4, #link-tab-index-6, #link-tab-index-5, #link-tab-index-3, #link-tab-index-7').addClass('disabled');
        jQuery('#form-gallery #btnsave').addClass('disabled');
        jQuery('#form-gallery #btnsavecontinue').addClass('disabled');
    });

});


function verifyAction() {

    //jQuery('#btnsavecontinue').trigger('click');
}

jQuery(document).ajaxStart(function () {
    jQuery("#loading").removeClass('hide');
});

jQuery(document).ajaxStop(function () {
    jQuery("#loading").addClass('hide');
});

var posy;
var dragging = false;
jQuery(document).ready(function () {


    var tab = 6;
    /* jQuery('#btnsavecontinue').click(function (e) {

     jQuery('#form-description').attr('action', "
    {{path('set_gallery', {'type':'continue' , 'prop_pk':prop_pk})}}");

     });

     jQuery('#link-tab-index-5').click(function () {
     jQuery('#btnsavecontinue').trigger('click');
     });

     jQuery('#btnsave').click(function (e) {
     jQuery('.tumb.active').parent().find('.title-input-source input').val(jQuery('.title-input input').val());
     jQuery('#form-location').attr('action', "
    {{path('set_gallery', {'type':'save' , 'prop_pk':prop_pk})}}");
     });*/
    //var newIndex = jQuery('.gallery').find('.col-sm-1').length - 1;
    // jQuery(jQuery('.gallery').find('.col-sm-1').last().find('input')[2]).val(newIndex);


    jQuery("#selectfile").click(function () {
        jQuery("#fileupload").trigger('click');
    });

    var count = 0;

    jQuery('.deleteImage').click(function (e) {

        if (confirm('Are you sure you want to delete this picture?')) {
            count++;
            var panelList = jQuery('.gallery');
            var div = document.createElement("div");
            var div1 = document.createElement("div");
            var span = document.createElement("span");
            jQuery(div1).addClass('image-form');
            jQuery(div).addClass('row col-xs-3 text-left no_padding');

            var aux = jQuery(jQuery('.col-xs-3', '.gallery')).length + count;
            var pictId = jQuery(jQuery(this).parent().find('input')[3]).val();


            jQuery.ajax({

                url: '{{path('new_image_form')}}',
                type: "POST",
                data: {i: aux, pictId: pictId, prop: "{{prop_pk}}"},
                async: false,
                success: function (response) {
                    jQuery(div1).html(response);

                }
            });

            jQuery(this).parent().remove();
            jQuery(span).addClass('orden');
            jQuery(span).html('24');
            jQuery(div1).append(span);
            jQuery(div).append(div1);

            jQuery(div).insertAfter(jQuery(jQuery('.col-xs-3', panelList)[22]));
            //document.getElementById("gallery").appendChild(div);

            jQuery('.col-sm-1', panelList).each(function (index, elem) {


                var $listItem = jQuery(elem),
                        newIndex = $listItem.index();
                // Persist the new indices.
                //alert(index);
                // jQuery('#gallery_propertyImages_'+index+'_order').val(newIndex);
                jQuery($listItem.find('.orden')).html(newIndex + 1);
                jQuery($listItem.find('input')[0]).val(newIndex - 1);
            });

            panelList.sortable("refresh");
            if (jQuery(jQuery('.tumb')[0]).hasClass('old')) {
                jQuery(jQuery('.tumb')[0]).trigger('click');
            } else if (jQuery(jQuery(jQuery('.tumb')[0]).parent().find('input')[1]).val() == '') {
                jQuery('.top-content').hide();
            }

            jQuery('.tumb').removeClass('active');
            jQuery(jQuery('.tumb')[0]).addClass('active');
            var bg = jQuery(jQuery('.tumb')[0]).css("background-image");
            jQuery('.tumb-large').css("background-image", bg);
            e.preventDefault();
        }


    });

    jQuery('.deleteImagePreview').click(function (e) {
        jQuery(this).parent().find('.tumb').css("background-image", "url({{ asset('bundles/common/images/image-bg.jpg') }})");

        var control = jQuery(jQuery(this).parent().find('input')[1]);
        var title = jQuery(jQuery(this).parent().find('input')[2]);
        var id = control.attr('id');
        var name = control.attr('name');

        control.replaceWith(jQuery('<input type="file" id=' + id + '  name=' + name + '  accept="image/*" onchange="preview(this);" />'));
        jQuery(this).parent().find('.tumb').removeClass('active');
        jQuery('.top-content').hide();
        jQuery('.tumb').removeClass('active');
        jQuery(this).parent().find('.tumb').addClass('active');
        jQuery(this).addClass('hide');
        title.val('');
        e.preventDefault();

    });


    jQuery('#btnadd').click(function (e) {

        jQuery('#btnadd').css('display', 'none');
        jQuery('.title').css('display', 'block');
        jQuery('.featured-image').css('display', 'block');
        jQuery('#form-buttons').css('display', 'block');
        e.preventDefault();
    });


    jQuery('#saveTitle').click(function (e) {

        var orden = jQuery(jQuery('.tumb.active').parent().find('input')[0]).val();
        var photo = jQuery(jQuery('.tumb.active').parent().find('input')[1]).prop('files')[0];
        var title = jQuery('.title-input').find('input').val();
        var pictId = jQuery(jQuery('.tumb.active').parent().find('input')[3]).val();
        var newUpload = jQuery('#newUpload').val();


        if (photo) {

            var post_data = new FormData();
            post_data.append('id', '{{prop_pk}}');
            post_data.append('pictId', pictId);
            post_data.append('orden', orden);
            post_data.append('photo', photo);
            post_data.append('title', title);


            jQuery.ajax({
                statusCode: {
                    200: function () {
                        //alert('asdad');
                        jQuery(jQuery('.tumb.active').parent().find('input')[2]).val(title);
                        jQuery(jQuery('.tumb.active').parent().find('input')[2]).attr('value', title);
                        jQuery('.tumb.active').removeClass('upload');
                        jQuery(jQuery('.tumb.active').parent().find('input')[1]).attr("disabled", 'disabled');
                        jQuery(jQuery('.tumb.active').parent().parent().find('#deleteImage')).removeClass('hide');
                        // jQuery('.tumb.active').unbind('click');
                    }
                },
                url: '{{path('save_image')}}',
                type: "POST",
                data: post_data,
                processData: false,
                contentType: false,
                async: false,
                success: function (response) {
                    if (pictId == 'new') {
                        jQuery('.tumb.active').parent().parent().find('.deleteImage').removeClass('hide');

                    }

                }
            });

        }

        e.preventDefault();


    });


    if (jQuery('.gallery').find('.col-xs-3').length == 0) {

        jQuery('#btnadd').css('display', 'inline-block');
        jQuery('.title').css('display', 'none');
        jQuery('.featured-image').css('display', 'none');
        jQuery('#form-buttons').css('display', 'none')
    }

    jQuery(".period-calendar").datepicker({});
    /* jQuery('.upload').click(function(){
     var $element_id = jQuery(this).attr('id');
     jQuery('#'+$element_id +'_photo').trigger('click');  ;

     });*/

    jQuery('.tumb').each(function (index, value) {

        jQuery(document).on("click", ".tumb", function () {


            jQuery('.tumb').removeClass('active');
            jQuery(this).addClass('active');

            if (jQuery(this).hasClass('old')) {
                var bg = jQuery(this).css("background-image");
                jQuery('.tumb-large').css("background-image", bg);
            }
            var source = jQuery(this).parent().find('.title-input-source input').val();
            jQuery('.title-input input').val(source);


            if (jQuery(this).parent().parent().index() != 0) {
                jQuery('.featured-picture').hide();
                //jQuery('.tumb-large').css('border','0px');
            } else {
                jQuery('.featured-picture').show();
                //jQuery('.tumb-large').css('border','2px solid #39b1dc');
            }


        });


    });


    jQuery(function ($) {
        var panelList = jQuery('.gallery');
        panelList.sortable({
            grid: [3, 8],
            // Only make the .panel-heading child elements support dragging.
            // Omit this to make then entire <li>...</li> draggable.
            //handle: '.tumb',
            update: function (event, ui) {
                jQuery('.tumb').removeClass('active');
                jQuery(ui.item).find('.tumb').addClass('active');
                var bg = jQuery(ui.item).find('.tumb').css("background-image");
                jQuery('.tumb-large').css("background-image", bg);
                var source = jQuery(ui.item).find('.tumb').parent().find('.title-input-source input').val();
                jQuery('.title-input input').val(source);
                if (ui.item.index() == 0) {

                    jQuery('.featured-picture').show();

                } else {

                    jQuery('.featured-picture').hide();
                }
                jQuery('.col-xs-3', panelList).each(function (index, elem) {

                    panelList.sortable("refresh");
                    var $listItem = jQuery(elem),
                            newIndex = $listItem.index() + 1;
                    // Persist the new indices.
                    //alert(index);
                    // jQuery('#gallery_propertyImages_'+index+'_order').val(newIndex);
                    jQuery($listItem.find('.orden')).html(newIndex);
                    jQuery($listItem.find('input')[0]).val(newIndex - 1);
                });

            },
            change: function (event, ui) {
                dragging = true;
            }

        });
    });

    jQuery(function () {

        jQuery(jQuery('.tumb')[0]).addClass('active');
        if (jQuery('.old').length == 0) {
            jQuery('.top-content').hide();
        } else {
            jQuery('.top-content').show();
            var bg = jQuery(jQuery('.tumb')[0]).css("background-image");
            jQuery('.tumb-large').css("background-image", bg);
        }


        var source = jQuery(jQuery('.tumb')[0]).parent().find('.title-input-source input').val();
        jQuery('.title-input input').val(source);
    });


});


jQuery(document).on("click", ".upload", function () {

    if (!dragging) {
        var $element_id = jQuery(this).attr("id");
        //jQuery("#" + $element_id + "_photo").trigger("click");
    }

});


jQuery(document).on("mousedown", ".upload", function () {
    dragging = false;
});


jQuery(document).on("keyup", ".title-input input", function () {
    jQuery(jQuery('.tumb.active').parent().find('input')[2]).val(jQuery(this).val());
});


function preview(input) {
    var panelList = jQuery('.gallery');
    //jQuery(input).parent().parent().find('#orden input').val(jQuery(input).index());
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {

            jQuery(input).parent().parent().find('.tumb').css('background-image', 'url(' + e.target.result + ')');
            jQuery('.tumb-large').css('background-image', 'url(' + e.target.result + ')');
        };
        reader.readAsDataURL(input.files[0]);
    }

    jQuery('.col-xs-3', panelList).each(function (index, elem) {

        panelList.sortable("refresh");
        var $listItem = jQuery(elem),
                newIndex = $listItem.index();
        // Persist the new indices.
        //alert(index);
        // jQuery('#gallery_propertyImages_'+index+'_order').val(newIndex);
        jQuery($listItem.find('.orden')).html(newIndex);
        jQuery($listItem.find('input')[0]).val(newIndex - 1);
    });

    jQuery('.tumb.active').parent().parent().find('.deleteImagePreview').removeClass('hide');
    jQuery('.top-content').show();

}


function handleFileSelect(evt) {
    var panelList = jQuery('.gallery');
    var output = panelList.find('.old').last().parent().parent();
    var files = evt.target.files; // FileList object
    panelList.sortable("refresh");
    // Loop through the FileList and render image files as thumbnails.
    for (var i = 0, f; f = files[i]; i++) {

        // Only process image files.
        if (!f.type.match('image.*')) {
            continue;
        }

        var reader = new FileReader();

        // Closure to capture the file information.
        reader.onload = (function (theFile) {
            return function (e) {
                // Render thumbnail.

                var length = jQuery('.old').length;
                var picFile = e.target;
                var div = document.createElement("div");
                var div1 = document.createElement("div");
                var div2 = document.createElement("div");
                var span = document.createElement("span");
                jQuery(div).addClass('row col-xs-3 text-left no_padding');
                jQuery(div1).addClass('image-form');
                jQuery(div2).addClass('tumb upload');
                var uploadId = length + i - files.length;
                jQuery(div2).attr('id', 'upload' + uploadId);
                jQuery(div2).css('background-image', 'url(' + picFile.result + ')');


                jQuery(div1).addClass('image-form');
                jQuery(div).addClass('row col-xs-3 text-left no_padding');
                jQuery(span).addClass('orden');


                jQuery(div1).append(div2);
                jQuery(div1).append(span);
                jQuery(panelList.find('.upload').parent().parent()[0]).remove();

                var post_data = new FormData();
                post_data.append('i', length + i++ - files.length);
                post_data.append('file', picFile.result);
                jQuery(span).html(uploadId);
                jQuery.ajax({

                    url: '{{path('image_multiple_form')}}',
                    type: "POST",
                    data: post_data,
                    processData: false,
                    contentType: false,
                    async: false,
                    success: function (response) {
                        jQuery(div1).append(response);
                        panelList.sortable("refresh");
                    }
                });

                jQuery(div).append(div1);
                jQuery(div).insertAfter(output);


            };
        })(f);

        // Read in the image file as a data URL.
        reader.readAsDataURL(f);
    }
    setTimeout(function () {
        jQuery('.col-xs-3', panelList).each(function (index, elem) {


            var $listItem = jQuery(elem),
                    newIndex = $listItem.index();
            // Persist the new indices.
            //alert(index);
            // jQuery('#gallery_propertyImages_'+index+'_order').val(newIndex);
            jQuery($listItem.find('.orden')).html(newIndex + 1);
            jQuery($listItem.find('input')[0]).val(newIndex - 1);
        });
    }, 500);

    evt.preventDefault();
}

//document.getElementById('uploadMultiple').addEventListener('change', handleFileSelect, false);


jQuery('.uploadMultipleVisible').click(function () {
    jQuery('#uploadMultiple').trigger('click');
});


</script>
