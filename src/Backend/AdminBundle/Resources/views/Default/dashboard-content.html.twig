
<div id="container" class="container-fluid properties-container-dashboard">
    {%if property is not empty %}



        <div class="list-row-dashboard">
            <div  class="row" style="margin: 0; padding-bottom: 10px;">
                <div class="col-md-8 col-xs-12">
                    <div  class="row" style="margin: 0;">
                        <div class="col-md-12 col-xs-12" style="margin: 10px 0 5px 0"></div>
                        <div class="col-md-5 col-xs-12">

                    {% if property.gallery is not null %}
                        {% if property.gallery.getPropertyImages |length > 0 %}
                      <div title="{{property.gallery.getPropertyImages[0].title}}"  class="tumb-admi-list-dash" style="background-image:url('{{ (property.gallery.getPropertyImages[0].getWebPath) | imagine_filter('my_thumb') }}');" >  </div>  
                       
                    {% else %} 
                 <div  class="tumb-admi-list-dash" style="background-image:url('{{ asset('bundles/common/images/000.jpg') }}');" >  </div>  
               
                  {% endif %}
              {% else %} 
                <div  class="tumb-admi-list-dash" style="background-image:url('{{ asset('bundles/common/images/000.jpg') }}');" >  </div>  
              {% endif %}


                </div>
              <div class="col-md-6 col-xs-12" >
                    <div class="row" style="padding: 10px 0 10px 0">
                        <div class="col-md-12 col-xs-12" style="padding-right: 0"><span class="property-title-1"> {{property.description.name}}</span> <span class="blue-title" style="font-size: 17px">({{property.serie}})</span></div>
                    </div>
                    <div class="row">
                        {%if property.location is not null %}
                        <div class="col-md-12 col-xs-12">{{property.location.address}}</div>
                        {%else %}
                            <div class="col-md-12 col-xs-12">Address Pending </div>
                            {%endif%}
                    </div>
                    
                    <div class="row hidden-xs" style="margin-top: 10px">
                <div class="col-md-12 col-xs-12">
                    
               <div class="basic" data-average="12" data-id="1"></div>
               <div class="basictemp pull-left" style="margin-right: 5px"></div>
               {% if property.status.name == 'active'%} <a href="{{ path('admin_user_reviews', {'id': property.serie, 'filtro': 'all'}) }}">Reviews ({{property.getReviews | length}})</a> {%endif%}
                  
                    
                </div>
            </div>
                  
               <div class="row notifications-panel" style="margin-top: 15px">
                        {% if property.status.name == 'active'%}
                        <div class="pull-left col-md-3" style="padding-top: 10px; padding-right: 0"><a data-toggle="tooltip" data-placement="top" title="New Inquiries" href="{{ path('admin_user_inquiries', {'id': property.serie ,'filtro': 'new'}) }}"><span class="glyphicon glyphicon-envelope" ></span><span class="badge" style="margin-left: 3px">{{property.getNewInquiries | length}}</span></a></div>
                        <div class="pull-left col-md-3"  style="padding-top: 10px;padding-right: 0"><a data-toggle="tooltip" data-placement="top" title="Pending Reservations" href="{{ path('admin_user_reservations',{'id': property.serie, 'filtro':'pending' }) }}"><span class="glyphicon glyphicon-calendar"></span><span class="badge" style="margin-left: 3px">{{property.getReservationsByStatus(5) | length}}</span></a></div>
                        <div class="pull-left col-md-3"  style=" padding-top: 10px;padding-right: 0"><a data-toggle="tooltip" data-placement="top" title="New Reviews" href="{{ path('admin_user_reviews',{'id': property.serie, 'filtro': 'new' }) }}"><span class="glyphicon glyphicon-comment" ></span><span class="badge" style="margin-left: 3px">{{property.getNewReviews(1) | length}}</span></a></div>
                        {%else%}
                         <div class="pull-left col-md-3" style="padding-top: 10px; padding-right: 0"><div data-toggle="tooltip" data-placement="top" title="New Inquiries" href=""><span class="glyphicon glyphicon-envelope" ></span><span class="badge" style="margin-left: 3px">0</span></div></div>
                        <div class="pull-left col-md-3"  style="padding-top: 10px;padding-right: 0"><div data-toggle="tooltip" data-placement="top" title="Pending Reservations" href=""><span class="glyphicon glyphicon-calendar"></span><span class="badge" style="margin-left: 3px">0</span></div></div>
                        <div class="pull-left col-md-3"  style=" padding-top: 10px;padding-right: 0"><div data-toggle="tooltip" data-placement="top" title="New Reviews" href=""><span class="glyphicon glyphicon-comment" ></span><span class="badge" style="margin-left: 3px">0</span></div></div>
                        
                        {%endif%}
                    </div>
                </div>
                        <div class="col-md-12 col-xs-12" style="margin-top: 25px">
                            {% if property.status.name == 'active'%}
                            <div class="row">
                            <div class="col-md-2 col-xs-4" style="padding-left: 5px"><div  class="fb-share-button" data-href="{{  path("property_profile", {'id': property.serie })  }}" data-layout="button_count"></div> </div>    
                            <div class="col-md-2 col-xs-4" style="padding-left: 5px"><a class="twitter-share-button"  href="{{  path("property_profile", {'id': property.serie })  }}"  data-via="twitterdev">Tweet</a></div>
                            <div class="col-md-2 col-xs-4" style="padding-left: 0px"><div class="g-plusone" data-size="medium" data-href="{{  path("property_profile", {'id': property.serie })  }}"></div></div>
                            </div>
                            {%elseif property.status.name == 'inactive'%}
                             <div class="row">
                            <div class="col-md-12 col-xs-12 text-inactive" style="padding-left: 5px">Your property is being reviewed. Pending approval, it will be live in 24-72 hours.</div>    
                             </div>   
                            {%endif%}    
                        </div>    
                        
                    </div>
                </div>
                
                
                
                        <div class="col-md-4 col-xs-12 calendario" style="margin-top: 10px">
                             {% if property.status.name == 'active'%}
                    <div class="row">
                        <div class="col-md-12 col-xs-12">
                            <div id="datepick" class="pull-right"></div>
                        </div>
                    </div>
                    <div class="row view">
                        <div class="col-md-12 col-xs-12">
                            <div class="pull-right"><a href="{{ path("admin_user_calendar", {'id': property.serie }) }}">View all</a></div>
                        </div>
                    </div>
                    <span id="loading-page" style=" left: 111px;position: absolute;top: 70px;z-index: 1000;">
                        <img src="{{ asset('bundles/common/images/loading.gif') }}" />
                    </span>     
                    {%endif%}
                </div>
  
            </div>
        </div>


        <div class="list-row-content hidden-xs" style=" padding: 15px 0px">
            <div class="row">
                <div class="col-md-8 col-xs-12">
                    <div class="dash-widget">

                        <div class="row">
                            <div class="col-md-8 col-xs-12">
                                <span class="dash-title">  What's New?</span>
                            </div>
                            <div class="col-md-2 col-xs-12 col-md-offset-1">
                                <span class="dash-title">Date</span> 
                            </div>
                        </div>
                        <hr>

                        <div class="dash-widget-content"> 
                            {% if news|length > 0 %}     
                                {% for new in news %}    
                                    <div class="row">
                                        <div class="col-md-8 col-xs-12">       
                                            <div class="dash-widget-item"><a href="{{ path("admin_news_detail", {'id': new.id }) }}">{{new.tittle}}</a></div>
                                        </div>
                                        <div class="col-md-2 col-xs-12 col-md-offset-1">       
                                            <div class="dash-widget-item text-muted" style="padding: 0;font-size: 13px">{{new.dateCreated|date("M j \\,\\ Y")}}</div> 
                                        </div>  

                                    </div> 
                                {% endfor %}
                            {% else %} 


                                <div class="row">
                                    <div class="col-xs-12 col-md-11">
                                        <div class="form-title" style="margin: 0">There are no News</div>
                                    </div>
                                </div>   
                            {% endif %}            


                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-md-12 col-xs-12 text-right">   {% if property.status.name == 'active'%}<a href="{{ path('admin_user_personal', {'filtro': 'full'}) }}">View older messages</a>{%endif%}</div>
                        </div>
                    </div>
                </div>


                <div class="col-md-4 col-xs-12">
                    <div class="dash-widget" style="background-color: #edf1f7;min-height: 220px">

                        <div class="row">
                            <div class="col-md-12 col-xs-12">
                                <span style="color: #2A6496">Recent Updates</span>    
                            </div>
                        </div>
                        <hr>

                        <div class="dash-widget-content"> 

                            <div class="row">
                                <div class="col-md-12 col-xs-12">       
                                    <div class="dash-widget-item">
                                        You have  {% if property.status.name == 'active'%}<a href="{{ path('admin_user_inquiries', {'id': property.serie ,'filtro': 'new' }) }}">{{inquiries_count}}</a>{%else%}<b>{{inquiries_count}}</b>{%endif%} new inquiries.</div>
                                </div>   
                            </div> 
                            <div class="row">
                                <div class="col-md-12 col-xs-12">       
                                    <div class="dash-widget-item">
                                        {% if property.status.name == 'active'%}
                                        {% if current_reservation is not null %}
                                            {{current_reservation.firstName}} is currently staying until <a href="{{ path("admin_user_calendar", {'id': property.serie }) }}">{{current_reservation.checkout |date("d/m/Y")}}</a>
                                        {% else %}
                                            The property is not currently reserved
                                        {% endif %} 
                                        
                                         {% else %}
                                            The property is not currently reserved
                                        {% endif %} 
                                    </div>
                                </div>   
                            </div>
                            <div class="row">
                                <div class="col-md-12 col-xs-12">       
                                    <div class="dash-widget-item">
                                         {% if property.status.name == 'active'%}
                                        
                                        {% if next_reservation |length > 0 %}
                                            {{next_reservation[0].firstName}} will arrive on <a href="{{ path("admin_user_calendar", {'id': property.serie }) }}">{{next_reservation[0].checkIn |date("d/m/Y")}}</a>
                                        {% else %}
                                            No reservations soon
                                        {% endif %}   

                                         {% else %}
                                            No reservations soon
                                        {% endif %} 

                                    </div>
                                </div>   
                            </div>
                            <div class="row">
                                <div class="col-md-12 col-xs-12">       
                                    <div class="dash-widget-item">
                                         {% if property.status.name == 'active'%}
                                        {% if  inquiries |length > 0 %}
                                            {{inquiries[0].guest}} has sent you a message.
                                        {% else %}
                                            No new messages
                                        {% endif %} 
                                         {% else %}
                                           No new messages
                                        {% endif %} 
                                    </div>
                                </div>   
                            </div>


                        </div>


                    </div>
                </div>

            </div>

            <div class="row" style="margin-top: 15px">
                <div class="col-md-8 col-xs-12">
                    <div class="dash-widget">

                        <div class="row">
                            <div class="col-md-8 col-xs-12">
                                <span class="dash-title"> Inquiries {% if property.status.name == 'active'%}( <a href="{{ path('admin_user_inquiries', {'id': property.serie ,'filtro': 'new' }) }}">{{inquiries_count}} new</a>) {%endif%}</span>
                            </div>
                            <div class="col-md-2 col-md-offset-1 col-xs-12">
                                <span class="dash-title"> Date </span>
                            </div>
                        </div>
                        <hr>

                        <div class="dash-widget-content"> 
                            {% if property.status.name == 'active'%}
                            {% if inquiries|length > 0 %}     
                                {% for key,inquiry in inquiries %}
                                    {% if key < 5%}
                                    <div class="row">
                                        <div class="col-md-4 col-xs-12">       
                                            <div class="dash-widget-item">
                                                {{inquiry.guest}}<br>
                                            {%if inquiry.phone != ""%}
                                                <i class="fa fa-phone-square" style="margin-right: 2px"></i>{{inquiry.phone}}
                                            {%endif%}
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-xs-12">       
                                            <div class="dash-widget-item">
                                            {%if inquiry.startDate != '' and inquiry.endDate != '' %}    
                                                
                                                {%if inquiry.startDate | date("Y") == inquiry.endDate | date("Y") and inquiry.startDate | date("M") == inquiry.endDate | date("M")%}
                                                {{inquiry.startDate | date("M j")}} - {{inquiry.endDate| date("j \\,\\ Y")}} 
                                                {% elseif inquiry.startDate | date("Y") == inquiry.endDate | date("Y") and inquiry.startDate | date("M") != inquiry.endDate | date("M")%}
                                                {{inquiry.startDate | date("M j")}} - {{inquiry.endDate| date("M j \\,\\ Y")}} 
                                                {% else%}
                                                {{inquiry.startDate | date("M j \\,\\ Y")}} - {{inquiry.endDate| date("M j \\,\\ Y")}} 
                                                {% endif%}
                                            {%else%}
                                                Dates Unspecified
                                                {% endif%},  
                                                {% set peop = inquiry.adults + inquiry.children%}
                                                 <b>{{ peop }}</b>
                                                 {% transchoice  peop %}
                                                    {0} people |{1} person |]1,Inf] people
                                                    {% endtranschoice %}
                                                   
                                                
                                                <p> 
                                                    <a href="#" data-toggle="modal" data-target="#myModalInquiryReadReply{{inquiry.id}}">{{ inquiry.text |slice(0, 40) }}...</a>
                                                   
                                                </p>

                                            </div> 
                                        </div>  

                                                <div class="col-md-2 col-xs-12" style="padding: 0">       
                                            <div class="dash-widget-item">
                                                <span class="text-muted" style="font-size: 13px">{{inquiry.dateCreated| date("M j \\,\\ Y")}}</span>
                                            </div> 
                                        </div> 

                                    </div> 
                                              {{ render(controller('AdminBundle:Default:replyInquiryForm',{ 'id': inquiry.id })) }} 
                                                {% endif %}
                                {% endfor %}
                            {% else %} 


                                <div class="row">
                                    <div class="col-xs-12 col-md-11">
                                        <div class="blue-title" style="margin: 0">There are no New Inquiries</div>
                                    </div>
                                </div>


                            {% endif %}        
                            
                             {% else %} 


                                <div class="row">
                                    <div class="col-xs-12 col-md-11">
                                        <div class="blue-title" style="margin: 0">There are no New Inquiries</div>
                                    </div>
                                </div>


                            {% endif %}        

                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-md-12 col-xs-12 text-right">    {% if property.status.name == 'active'%}<a href="{{ path('admin_user_inquiries', {'id': property.serie,'filtro': 'full' }) }}">View older inquiries</a>{%endif%}</div>
                        </div>
                    </div>
                </div>


                <div class="col-md-4 col-xs-12">
                    <div class="dash-widget">

                        <div class="row">
                            <div class="col-md-12 col-xs-12">
                                <span class="dash-title"> Listing Summary </span>
                            </div>
                        </div>
                        <hr>

                        <div class="dash-widget-content"> 

                            <div class="row">
                                <div class="col-md-12 col-xs-12">       
                                    <div class="dash-widget-item">
                                        <div class="row">
                                            <div class="col-md-4 col-xs-12"> 
                                                Status
                                            </div>   
                                            <div class="col-md-8 col-xs-12">
                                                
                                                <span class="text-{{property.status.name}}">{{property.status.name}}</span>
                                            </div> 
                                        </div> 
                                    </div>

                                </div>   
                            </div> 
                            <div class="row">
                                <div class="col-md-12 col-xs-12">       
                                    <div class="dash-widget-item">
                                        <div class="row">
                                            <div class="col-md-4 col-xs-12"> 
                                                Visits
                                            </div>   
                                            <div class="col-md-8 col-xs-12"> 
                                                <span class="badge">{{property.views}}</span>  
                                            </div> 
                                        </div>   
                                    </div>
                                </div>   
                            </div>
                            <div class="row">
                                <div class="col-md-12 col-xs-12">       
                                    <div class="dash-widget-item">
                                        <div class="row">
                                            <div class="col-md-4 col-xs-12"> 
                                                Updated
                                            </div>   
                                            <div class="col-md-8 col-xs-12"> 
                                                {{property.dateUpdated | date("F jS \\,\\ Y")}}
                                            </div> 
                                        </div> 
                                    </div>
                                </div>   
                            </div>
                            <div class="row">
                                <div class="col-md-12 col-xs-12">       
                                    <div class="dash-widget-item">
                                        <div class="row">
                                            <div class="col-md-4 col-xs-12"> 
                                                Listed On
                                            </div>   
                                            <div class="col-md-8 col-xs-12"> 
                                                {{property.dateCreated | date("F jS \\,\\ Y")}}
                                            </div> 
                                        </div>
                                    </div>
                                </div>   
                            </div>


                        </div>

                    </div>
                </div>

            </div>
        </div>

<!------------------------------------- MOBILE Widgets ------------------------------------------------------>
<div class="list-row-content visible-xs" style=" padding: 15px 0px">

<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
    <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingOne">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
        <div class="row">
              <div class="col-md-8 col-xs-12">
                    <span class="dash-title">  What's New?</span>
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                     <span class="glyphicon glyphicon-chevron-down pull-right" aria-hidden="true"></span>
                    </a> 
              </div>
        </div>
        </a>
      </h4>
        
    </div>
   <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
      <div class="panel-body">
       {% if news|length > 0 %}     
                                {% for new in news %}    
                                    <div class="row">
                                        <div class="col-md-8 col-xs-12">       
                                            <div class="dash-widget-item"><a href="{{ path("admin_news_detail", {'id': new.id }) }}">{{new.tittle}}</a></div>
                                        </div>
                                        <div class="col-md-2 col-xs-12 col-md-offset-1">       
                                            <div class="dash-widget-item text-muted" style="padding: 0;font-size: 13px">{{new.dateCreated|date("M j \\,\\ Y")}}</div> 
                                        </div>  

                                    </div> 
                                {% endfor %}
                            {% else %} 


                                <div class="row">
                                    <div class="col-xs-12 col-md-11">
                                        <div class="form-title" style="margin: 0">There are no News</div>
                                    </div>
                                </div>   
                            {% endif %} 
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingThree">
      <h4 class="panel-title">
       <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
        <div class="row">
                            <div class="col-md-8 col-xs-12">
                                <span class="dash-title"> Inquiries  {% if property.status.name == 'active'%} (<a href="{{ path('admin_user_inquiries', {'id': property.serie ,'filtro': 'new' }) }}">{{inquiries_count}} new</a>) {%endif%}</span>
                                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                    <span class="glyphicon glyphicon-chevron-down pull-right" aria-hidden="true"></span>
                                </a>
                            </div>
        </div>
       </a>
      </h4>
    </div>
    <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
      <div class="panel-body">
          {% if property.status.name == 'active'%}
       {% if inquiries|length > 0 %}     
                                {% for key,inquiry in inquiries %}
                                    {% if key < 5%}
                                    <div class="row">
                                        <div class="col-md-4 col-xs-12">       
                                            <div class="dash-widget-item">
                                                {{inquiry.guest}}<br>
                                            {%if inquiry.phone != ""%}
                                                <i class="fa fa-phone-square" style="margin-right: 2px"></i>{{inquiry.phone}}
                                            {%endif%}
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-xs-12">       
                                            <div class="dash-widget-item">
                                            {%if inquiry.startDate != '' and inquiry.endDate != '' %}    
                                                
                                                {%if inquiry.startDate | date("Y") == inquiry.endDate | date("Y") and inquiry.startDate | date("M") == inquiry.endDate | date("M")%}
                                                {{inquiry.startDate | date("M j")}} - {{inquiry.endDate| date("j \\,\\ Y")}} 
                                                {% elseif inquiry.startDate | date("Y") == inquiry.endDate | date("Y") and inquiry.startDate | date("M") != inquiry.endDate | date("M")%}
                                                {{inquiry.startDate | date("M j")}} - {{inquiry.endDate| date("M j \\,\\ Y")}} 
                                                {% else%}
                                                {{inquiry.startDate | date("M j \\,\\ Y")}} - {{inquiry.endDate| date("M j \\,\\ Y")}} 
                                                {% endif%}
                                            {%else%}
                                                Dates Unspecified
                                                {% endif%},  
                                                {% set peop = inquiry.adults + inquiry.children%}
                                                 <b>{{ peop }}</b>
                                                 {% transchoice  peop %}
                                                    {0} people |{1} person |]1,Inf] people
                                                    {% endtranschoice %}
                                                   
                                                
                                                <p> 
                                                    <a href="#" data-toggle="modal" data-target="#myModalInquiryReadReply{{inquiry.id}}">{{ inquiry.text |slice(0, 40) }}...</a>
                                                   
                                                </p>

                                            </div> 
                                        </div>  

                                                <div class="col-md-2 col-xs-12" style="padding: 0">       
                                            <div class="dash-widget-item">
                                                <span class="text-muted" style="font-size: 13px">{{inquiry.dateCreated| date("M j \\,\\ Y")}}</span>
                                            </div> 
                                        </div> 

                                    </div> 
                                              {{ render(controller('AdminBundle:Default:replyInquiryForm',{ 'id': inquiry.id })) }} 
                                                {% endif %}
                                {% endfor %}
                            {% else %} 


                                <div class="row">
                                    <div class="col-xs-12 col-md-11">
                                        <div class="blue-title" style="margin: 0">There are no New Inquiries</div>
                                    </div>
                                </div>


                            {% endif %}  
                            
                             {% else %} 


                                <div class="row">
                                    <div class="col-xs-12 col-md-11">
                                        <div class="blue-title" style="margin: 0">There are no New Inquiries</div>
                                    </div>
                                </div>


                            {% endif %}  
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingFour">
      <h4 class="panel-title">
       <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
        <div class="row">
                            <div class="col-md-8 col-xs-12">
                               <span class="dash-title"> Listing Summary </span>
                               <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                   <span class="glyphicon glyphicon-chevron-down pull-right" aria-hidden="true"></span>
                               </a>
                            </div>
        </div>
       </a>
      </h4>
    </div>
    <div id="collapseFour" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFour">
      <div class="panel-body">
        <div class="row">
                                <div class="col-md-12 col-xs-12" style="padding: 0">       
                                    <div class="dash-widget-item">
                                        <div class="row">
                                            <div class="col-md-4 col-xs-5"> 
                                                Status
                                            </div>   
                                            <div class="col-md-8 col-xs-7" style="padding: 0"> 
                                                <span class="text-{{property.status.name}}">{{property.status.name}}</span>
                                            </div> 
                                        </div> 
                                    </div>

                                </div>   
                            </div> 
                            <div class="row">
                                <div class="col-md-12 col-xs-12" style="padding: 0">       
                                    <div class="dash-widget-item">
                                        <div class="row">
                                            <div class="col-md-4 col-xs-5"> 
                                                Visits
                                            </div>   
                                            <div class="col-md-8 col-xs-7" style="padding: 0"> 
                                                <span class="badge">{{property.views}}</span>  
                                            </div> 
                                        </div>   
                                    </div>
                                </div>   
                            </div>
                            <div class="row">
                                <div class="col-md-12 col-xs-12" style="padding: 0">       
                                    <div class="dash-widget-item">
                                        <div class="row">
                                            <div class="col-md-4 col-xs-5"> 
                                                Updated
                                            </div>   
                                            <div class="col-md-8 col-xs-7" style="font-size: 12px; padding: 0" > 
                                                {{property.dateUpdated | date("F j \\,\\ Y")}}
                                            </div> 
                                        </div> 
                                    </div>
                                </div>   
                            </div>
                            <div class="row">
                                <div class="col-md-12 col-xs-12" style="padding: 0">       
                                    <div class="dash-widget-item">
                                        <div class="row">
                                            <div class="col-md-4 col-xs-5"> 
                                                Listed On
                                            </div>   
                                            <div class="col-md-8 col-xs-7" style="font-size: 12px; padding: 0"> 
                                                {{property.dateCreated | date("F j \\,\\ Y")}}
                                            </div> 
                                        </div>
                                    </div>
                                </div>   
                            </div> 
            </div>
          </div>
        </div>
      </div>
                                           
</div>
<!-------------------------------------- End MOBILE Widget -------------------------------------------------------------->                               
                                            
                                            

    {% else %} 
        <div  class="row"  style="margin: 10px 0 20px 0">
            <div  class="row"  style="margin: 10px 0 20px 0">
                <div class="row" style="margin: 20px 10px 0 ">
                    <div class="col-xs-12 col-md-12">
                        <div class="alert alert-info"><span class="glyphicon glyphicon-info-sign" style="margin-right: 15px;  top: 3px;"></span> This property does not exist</div>
                    </div>
                </div>


            {% endif %}
        </div>

        {{ include('AdminBundle:Default:reservationDashboard-form.html.twig') }}
    </div>
</div>

    <script type="text/javascript">
        jQuery(document).ready(function() {

        jQuery('.basic').jRating({
        isDisabled:true,
                nbRates : 0,
                sendRequest: false,
                rateMax : 5,
                bigStarsPath : '../../bundles/common/css/icons/stars.png', // path of the icon stars.png
                smallStarsPath : '../../bundles/common/css/icons/small.png', // path of the icon small.png

        });
                jQuery('.basictemp').attr("data-average",{{rating}} ).attr("data-id", 1);
                jQuery('.basic').remove();
                jQuery('.basictemp').jRating({
        isDisabled:true,
                nbRates : 0,
                sendRequest: false,
                rateMax : 5,
                showRateInfo: true,
                bigStarsPath : '../../bundles/common/css/icons/stars.png', // path of the icon stars.png
                smallStarsPath : '../../bundles/common/css/icons/small.png', // path of the icon small.png

        });
                function showForm(date){
                jQuery('#myModal').modal('show');
                }

   
                function createPopover(elem, text){
                elem.attr('data-toggle', 'popover');
                        elem.attr('data-placement', 'bottom');
                        elem.attr('data-content', text);
                        elem.attr('data-container', 'body');
                        elem.popover();
                        elem.trigger('click');
                        elem.focus();
                }

        jQuery('.reservation-form').find('input , select').each(function(){
        jQuery(this).focusout(function(){
        jQuery(this).popover('destroy');
        });
        });
                function checkLength(o, min, max) {
                if (o.val().length < min) {
                createPopover(o, 'Please fill out this field');
                        return false;
                } else {
                return true;
                }
                }


        function checkRegexp(o, regexp) {
        if (!(regexp.test(o.val()))) {
        createPopover(o, 'Invalid field');
                return false;
        } else {
        return true;
        }
        }


        function checkSelected(o) {
        if (o.val() == "") {
        createPopover(o, 'Please fill out this field');
                return false;
        } else {
        return true;
        }
        }

        function checkDate(o, u) {
        if (u.val() !== '' && o.val() !== ''){
        if (u.val() <= o.val()) {
        createPopover(u, 'Invalid Date');
                return false;
        } else {
        return true;
        }
        } else  if (u.val() !== '' && o.val() === ''){
        createPopover(o, 'Please fill out this field');
                return false;
        } else  if (o.val() !== '' && u.val() === ''){
        createPopover(u, 'Please fill out this field');
                return false;
        } else  if (o.val() === '' && u.val() === ''){
        return true;
        }
        }

          function validateForm(){
            var bValid = true;
            bValid = bValid && checkLength(jQuery('#reservation_firstName'), 2, 100);
            bValid = bValid && checkLength(jQuery('#reservation_lastName'), 2, 100);
            bValid = bValid && checkLength(jQuery('#reservation_email'), 4, 100);
            bValid = bValid && checkRegexp(jQuery('#reservation_email'), /^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);
            bValid = bValid && checkDate(jQuery('#reservation_checkIn'), jQuery('#reservation_checkOut'));
            bValid = bValid && checkValidRange(jQuery('#reservation_checkIn'), jQuery('#reservation_checkOut'));
            bValid = bValid && checkSelected(jQuery('#reservation_checkinhour'));
            bValid = bValid && checkSelected(jQuery('#reservation_checkouthour'));
           if (bValid){
    disableForm();
            submitForm();
    }

    }




       function submitForm(){
    jQuery.ajax({
    statusCode: {
    500: function() {
    enableForm();
            jQuery('#error').html("<span class='glyphicon glyphicon-warning-sign' style='margin-right:15px;color:#d9534f'></span><span class='text-danger'>The property is reserved on this date range</span>");
    },
            401: function() {
            enableForm();
                    jQuery('#error').html("<span class='glyphicon glyphicon-warning-sign' style='margin-right:15px;color:#d9534f'></span><span class='text-danger'>There was an error on the form. Try again</span>");
            }
    },
            url: '{{ path('create_reservation_calendar') }}',
            type: "POST",
            data: {  id : {{property.id}} ,
                    firstName: jQuery('#reservation_firstName').val(),
                    lastName: jQuery('#reservation_lastName').val(),
                    checkIn: jQuery('#reservation_checkIn').val(),
                    checkOut: jQuery('#reservation_checkOut').val(),
                    checkinhour: jQuery('#reservation_checkinhour').val(),
                    checkouthour: jQuery('#reservation_checkouthour').val(),
                    adults: jQuery('#reservation_adults').val(),
                    children: jQuery('#reservation_children').val(),
                    email: jQuery('#reservation_email').val(),
                    phone: jQuery('#reservation_phone').val(),
                    mobile: jQuery('#reservation_mobile').val()
            },
            async: false,
            success: function(response){
            jQuery.ajax({
            url: '{{path('calendar_reservations')}}',
                    type: "POST",
                    dataType: 'json',
                    data: { id : {{property.id}} },
                    async: false,
                    success: function(response){

                    bookedDatesAux = response[0];
                            inquiriesDatesAux = response[1];
                            for (var i = 0; i < bookedDatesAux.length; i++){
                    bookedDates.push(bookedDatesAux[i]);
                    }

                    for (var i = 0; i < inquiriesDatesAux.length; i++){
                    inquiriesDates.push(inquiriesDatesAux[i]);
                    }

                    jQuery("#loading").hide();
                            jQuery(".reservation-form").css("opacity", 1);
                            jQuery(".reservation-form").find("button").css("opacity", 1);
                    }
            });
                    jQuery('#datepick').datepicker("refresh");
                    jQuery('#myModal').modal('hide');
                    resetForm();
                    enableForm();
            }
    });
            }
        
            jQuery(function() {
                            jQuery('#datepick').datepicker({minDate: new Date(), beforeShowDay: showBooked,
                                    onSelect: function(dateStr, obj) {
                                    var date = jQuery(this).datepicker('getDate');
                                            var settings = showBooked(date);
                                            if (settings[1] == 'free' || settings[1] == 'tentative') {

                                    jQuery('#reservation_checkIn').val(dateStr);
                                            jQuery('#reservation_checkOut').val(dateStr);
                                            jQuery('#reservation_checkIn').attr('disabled', 'disabled');
                                            showForm(dateStr);
                                    }
                                    
                                    }
                            });
                                    });



          function checkValidRange(checkin, checkout){
    var inday = new Date(checkin.val()).getDate() + 1;
            var inmonth = new Date(checkin.val()).getMonth() + 1;
            var inyear = new Date(checkin.val()).getFullYear();
            var outday = new Date(checkout.val()).getDate() + 1;
            var outmonth = new Date(checkout.val()).getMonth() + 1;
            var outyear = new Date(checkout.val()).getFullYear();
            //var strtime = date.toLocaleDateString();
            //alert( bookedDates[0]);
            for (var i = 0; i < bookedDates.length; i++) {
    //alert(bookedDates[i]);
    for (var j = 0; j < bookedDates[i].length; j++) {
    if (new Date(bookedDates[i][j]) >= new Date(inmonth + '/' + inday + '/' + inyear) && new Date(bookedDates[i][j]) <= new Date(outmonth + '/' + outday + '/' + outyear)) {
    createPopover(checkin, 'Invalid date');
            createPopover(checkout, 'Invalid date');
            return false;
    }
    }
    }

    return true;
    }


        function disableForm(){
        jQuery('.ui-dialog').find('input , select, button').attr('disabled', 'disabled')
                jQuery("#loading").show();
                jQuery(".reservation-form").css("opacity", 0.37);
                jQuery(".ui-dialog").find(".ui-dialog-buttonset").css("opacity", 0.37);
        }

        function resetForm(){
        jQuery('.ui-dialog').find('input').val('');
                jQuery('.ui-dialog').find('#reservation_adults').val('');
                jQuery('.ui-dialog').find('#reservation_children').val('');
                jQuery('.ui-dialog').find('#reservation_checkinhour').val('');
                jQuery('.ui-dialog').find('#reservation_checkouthour').val('');
        }

        function enableForm(){
        jQuery('.ui-dialog').find('input , select, button').removeAttr('disabled')
        }

      
          
         jQuery('.book').click(function (){
        validateForm();
        });
             



        jQuery('#reservation_checkIn').click(function(){
        jQuery("#ui-datepicker-div").css("z-index", 2000);
        });
                jQuery('#reservation_checkOut').click(function(){
        jQuery("#ui-datepicker-div").css("z-index", 2000);
        });
                jQuery('#login').click(function(e){
        e.preventDefault();
        });
                jQuery("#reservation_checkOut").datepicker({ minDate: new Date(), beforeShowDay: showBooked

        });
        
          jQuery(function () {
                    jQuery('[data-toggle="tooltip"]').tooltip();
                });
           
        });
        
        
             var bookedDates = [];
                var inquiriesDates = [];
                var bookedDatesAux = [];
                var inquiriesDatesAux = [];
                //var dateArray = [new Date(2014, 8-1, 25),new Date(2014, 8-1, 26), new Date(2014, 8-1, 27)]; 
                jQuery(function() {
                jQuery('#loading-page').show();
                        jQuery('.view').hide();
                        jQuery.ajax({
                        url: '{{path('AcmeHomeBundle_ajax_update_mydata')}}',
                                type: "POST",
                                dataType: 'json',
                                data: { id : {{property.id}} },
                                async: false,
                                success: function(response){
                                bookedDatesAux = response[0];
                                        inquiriesDatesAux = response[1];
                                        for (var i = 0; i < bookedDatesAux.length; i++){
                                bookedDates.push(bookedDatesAux[i]);
                                }

                                for (var i = 0; i < inquiriesDatesAux.length; i++){
                                inquiriesDates.push(inquiriesDatesAux[i]);
                                }
                                jQuery('.view').show();
                                jQuery('#loading-page').hide();
                                }
                        });
                });
        
         function showBooked(date) {//new Date(bookedDates[0]*1000).toDateString()

                var year = date.getFullYear();
                        var month = date.getMonth();
                        var day = date.getDate();
                        //var strtime = date.toLocaleDateString();
                        //alert( bookedDates[0]);
                        for (var i = 0; i < bookedDates.length; i++) {
                //alert(bookedDates[i]);
                for (var j = 0; j < bookedDates[i].length; j++) {
                if (month + 1 + '/' + day + '/' + year == bookedDates[i][j]) {

                return [false, 'booked'];
                }
                }
                }

                for (var i = 0; i < inquiriesDates.length; i++) {
                //alert(bookedDates[i]);
                for (var j = 0; j < inquiriesDates[i].length; j++) {
                if (month + 1 + '/' + day + '/' + year == inquiriesDates[i][j]) {

                return [true, 'tentative'];
                }
                }
                }

                return [true, 'free'];
                }

    </script>