<div class="modal fade" id="myModalInquiryReadReply{{id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Read & Reply</h4>
            </div>
            <div class="modal-body">
                <form id="formReadReply" action="{{ path('save_inquiry_reply') }}" {{ form_enctype(form) }} method="POST" class="form-horizontal">
                    <input type="hidden" name="_csrf_token"   value="{{ csrf_token('registration') }}">
                    <div class="row" style="margin-bottom: 20px">
                        <div class="col-md-12 col-sm-12 col-xs-12">
                            <p>{{inq.guest}} {{inq.lastName}}: {{inq.text}} </p>
                        </div>


                    </div>
                   
                    <div class="row">
                        <div class="col-md-12 col-sm-12 col-xs-12">Reply</div>
                        <div class="col-md-12 col-sm-12 col-xs-12">{{ form_widget(form.text) }}</div>       



                    </div>






                    <div style="display: none">{{ form_rest(form) }}</div>
                    <input type="hidden" id="viewed" name="inqId" value="{{inq.viewed}}" >
                    <input type="hidden" id="resId" name="inqId" value="{{id}}" >

                </form>
            </div>
            <div class="modal-footer">
                <div class="row">
                    <div class="col-md-7 col-sm-7 col-xs-12"><div id="error"></div></div>
                    <div class="col-sm-5 col-xs-12">
                        <button type="button" class="btn btn-default close-btn" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary confirm-send">Send</button>   
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>





<script type="text/javascript">

    jQuery(document).ready(function () {



        function disableFormReadReply() {
            jQuery('#myModalInquiryReadReply{{id}} #formReadReply').find('textarea').attr('disabled', 'disabled')
            jQuery("#myModalInquiryReadReply{{id}} #formReadReply").css("opacity", 0.37);
        }



        function enableFormReadReply() {
            jQuery('#myModalInquiryReadReply{{id}} #formReadReply').find('textarea').val('');
            jQuery('#myModalInquiryReadReply{{id}} #formReadReply').find('textarea').removeAttr('disabled');
            jQuery("#myModalInquiryReadReply{{id}} #formReadReply").css("opacity", 1);
        }

        function submitFormReadReply() {

            jQuery.ajax({
                statusCode: {
                    500: function () {
                        //enableFormConfirmReservation();
                        jQuery('#myModalInquiryReadReply{{id}} #error').html("<span class='glyphicon glyphicon-warning-sign' style='margin-right:15px;color:#d9534f'></span><span class='text-danger'>There was an error, try again</span>");
                    }
                },
                url: jQuery('#myModalInquiryReadReply{{id}} #formReadReply').attr('action'),
                type: "POST",
                data: {id: '{{id}}', text: jQuery('#myModalInquiryReadReply{{id}} #inquiryReply_text').val()},
                async: false,
                success: function (response) {
                    enableFormReadReply();
                    jQuery('#myModalInquiryReadReply{{id}}').modal('hide');
                }
            });
        }


        jQuery('#myModalInquiryReadReply{{id}} .confirm-send').click(function (e) {
            //alert(jQuery('#myModalCancel{{id}} #formReservationCancel').serialize());    
            validateFormReadReply();

        });

        jQuery('#myModalInquiryReadReply{{id}}').find('textarea').each(function () {
            jQuery(this).focusout(function () {
                jQuery(this).popover('destroy');
            });
        });


        function validateFormReadReply() {
            var bValid = true;
            bValid = bValid && checkLength(jQuery('#myModalInquiryReadReply{{id}} #inquiryReply_text'), 5, 500);
            if (bValid) {
                disableFormReadReply();
                submitFormReadReply();
            }

        }

        function checkLength(o, min, max) {
            if (o.val().length < min) {
                createPopover(o, 'Please fill out this field');
                return false;
            } else {
                return true;
            }
        }

        function createPopover(elem, text) {
            elem.attr('data-toggle', 'popover');
            elem.attr('data-placement', 'bottom');
            elem.attr('data-content', text);
            elem.attr('data-container', 'body');
            elem.popover();
            elem.trigger('click');
            elem.focus();
        }

        jQuery('#myModalInquiryReadReply{{id}}').on('shown.bs.modal', function (e) {
           if(!jQuery('#myModalInquiryReadReply{{id}} #viewed').val() || jQuery('#myModalInquiryReadReply{{id}} #viewed').val() == ""){
                     jQuery.ajax({
                statusCode: {
                    500: function () {
                        //enableFormConfirmReservation();
                        jQuery('#myModalInquiryReadReply{{id}} #error').html("<span class='glyphicon glyphicon-warning-sign' style='margin-right:15px;color:#d9534f'></span><span class='text-danger'>There was an error, try again</span>");
                    }
                },
                url: '{{ path('update_new_inquiry') }}',
                type: "POST",
                data: {id: '{{id}}'},
                async: false,
                success: function (response) {
                jQuery('#myModalInquiryReadReply{{id}} #viewed').val(true);
                }
            });
           }
           
        });
       


    });






</script>